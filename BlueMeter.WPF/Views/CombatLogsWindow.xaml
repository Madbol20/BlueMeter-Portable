<Window
    x:Class="BlueMeter.WPF.Views.CombatLogsWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:b="http://schemas.microsoft.com/xaml/behaviors"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:vm="clr-namespace:BlueMeter.WPF.ViewModels"
    xmlns:ctrl="clr-namespace:BlueMeter.WPF.Controls"
    Title="Combat Logs Manager"
    Width="1100"
    Height="650"
    MinWidth="900"
    MinHeight="500"
    Style="{StaticResource TransparentWindow}"
    d:DataContext="{d:DesignInstance Type=vm:CombatLogsWindowViewModel}"
    mc:Ignorable="d">

    <WindowChrome.WindowChrome>
        <WindowChrome
            CaptionHeight="0"
            GlassFrameThickness="0"
            ResizeBorderThickness="6"
            UseAeroCaptionButtons="False" />
    </WindowChrome.WindowChrome>

    <b:Interaction.Triggers>
        <b:EventTrigger EventName="Loaded">
            <b:InvokeCommandAction Command="{Binding LoadedCommand}" />
        </b:EventTrigger>
    </b:Interaction.Triggers>

    <Border Style="{StaticResource ShadowWindowBorder}" Background="#ECEBE9">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>

            <!-- Header -->
            <ctrl:Header Title="Combat Logs Manager" Grid.Row="0" />

            <!-- Content -->
            <Border Grid.Row="1" Margin="10" Background="White" CornerRadius="5" BorderBrush="#E5E5E5" BorderThickness="2">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>

                    <!-- Toolbar -->
                    <Border Grid.Row="0" Background="#2297F4" Padding="10">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>

                            <!-- Title & Stats -->
                            <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                                <TextBlock
                                    Text="ðŸ“¦ Stored Combat Logs"
                                    Foreground="White"
                                    FontWeight="Bold"
                                    FontSize="14"
                                    VerticalAlignment="Center" />
                                <TextBlock
                                    Margin="12,0,0,0"
                                    Foreground="White"
                                    FontSize="12"
                                    VerticalAlignment="Center">
                                    <Run Text="{Binding TotalEncounters, Mode=OneWay}" FontWeight="Bold" />
                                    <Run Text="/" />
                                    <Run Text="{Binding MaxEncounters, Mode=OneWay}" />
                                    <Run Text=" encounters  â€¢  " />
                                    <Run Text="{Binding TotalDiskUsage, Mode=OneWay}" FontWeight="Bold" />
                                </TextBlock>
                            </StackPanel>

                            <!-- Action Buttons -->
                            <StackPanel Grid.Column="2" Orientation="Horizontal">
                                <Button
                                    Content="ðŸ”„ Refresh"
                                    Command="{Binding RefreshCommand}"
                                    Style="{StaticResource AntButtonStyle}"
                                    Padding="12,5"
                                    Foreground="White"
                                    Background="#1890FF"
                                    BorderThickness="0" />
                                <Button
                                    Margin="8,0,0,0"
                                    Content="ðŸ“ Open Folder"
                                    Command="{Binding OpenLogFolderCommand}"
                                    Style="{StaticResource AntButtonStyle}"
                                    Padding="12,5"
                                    Foreground="White"
                                    Background="#52C41A"
                                    BorderThickness="0" />
                            </StackPanel>
                        </Grid>
                    </Border>

                    <!-- Logs List -->
                    <DataGrid
                        Grid.Row="1"
                        ItemsSource="{Binding LogItems}"
                        SelectedItem="{Binding SelectedLogItem}"
                        AutoGenerateColumns="False"
                        CanUserAddRows="False"
                        CanUserDeleteRows="False"
                        IsReadOnly="True"
                        SelectionMode="Single"
                        HeadersVisibility="Column"
                        GridLinesVisibility="Horizontal"
                        HorizontalGridLinesBrush="#E5E5E5"
                        RowHeight="40"
                        AlternatingRowBackground="#F9F9F9"
                        MouseDoubleClick="DataGrid_MouseDoubleClick">

                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Date &amp; Time" Binding="{Binding FormattedDate}" Width="150" />
                            <DataGridTextColumn Header="Boss/Target" Binding="{Binding BossName}" Width="180" />
                            <DataGridTextColumn Header="Encounter ID" Binding="{Binding EncounterId}" Width="140">
                                <DataGridTextColumn.ElementStyle>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="FontFamily" Value="Consolas" />
                                        <Setter Property="FontSize" Value="11" />
                                        <Setter Property="Foreground" Value="#666" />
                                    </Style>
                                </DataGridTextColumn.ElementStyle>
                            </DataGridTextColumn>
                            <DataGridTextColumn Header="File Size" Binding="{Binding FormattedSize}" Width="90" />
                            <DataGridTextColumn Header="File Name" Binding="{Binding FileName}" Width="*">
                                <DataGridTextColumn.ElementStyle>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="FontFamily" Value="Consolas" />
                                        <Setter Property="FontSize" Value="11" />
                                    </Style>
                                </DataGridTextColumn.ElementStyle>
                            </DataGridTextColumn>
                        </DataGrid.Columns>

                        <DataGrid.Resources>
                            <Style TargetType="DataGridColumnHeader">
                                <Setter Property="Background" Value="#F5F5F5" />
                                <Setter Property="Foreground" Value="#333" />
                                <Setter Property="FontWeight" Value="Bold" />
                                <Setter Property="Padding" Value="10,8" />
                                <Setter Property="BorderBrush" Value="#E5E5E5" />
                                <Setter Property="BorderThickness" Value="0,0,1,1" />
                            </Style>
                            <Style TargetType="DataGridCell">
                                <Setter Property="Padding" Value="10,5" />
                                <Setter Property="BorderThickness" Value="0" />
                                <Style.Triggers>
                                    <Trigger Property="IsSelected" Value="True">
                                        <Setter Property="Background" Value="#E3F2FD" />
                                        <Setter Property="Foreground" Value="#000" />
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                            <Style TargetType="DataGridRow">
                                <Style.Triggers>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter Property="Background" Value="#F0F0F0" />
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </DataGrid.Resources>
                    </DataGrid>

                    <!-- Status Bar -->
                    <Border Grid.Row="2" Background="#F5F5F5" BorderBrush="#E5E5E5" BorderThickness="0,1,0,0" Padding="10,5">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>

                            <TextBlock
                                Grid.Column="0"
                                Text="{Binding StatusMessage}"
                                VerticalAlignment="Center"
                                Foreground="#666" />

                            <ProgressBar
                                Grid.Column="1"
                                Width="200"
                                Height="20"
                                IsIndeterminate="True"
                                Visibility="{Binding IsLoading, Converter={StaticResource BoolToVisibilityConverter}}" />
                        </Grid>
                    </Border>
                </Grid>
            </Border>

            <!-- Footer with Action Buttons -->
            <Border Grid.Row="2" Height="60" Background="#F5F5F5" BorderBrush="#E5E5E5" BorderThickness="0,1,0,0">
                <Grid Margin="10">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="10" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="10" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <!-- Left Side: View Details & Replay -->
                    <StackPanel Grid.Column="0" Orientation="Horizontal">
                        <Button
                            Content="â–¶ï¸ View Replay"
                            Command="{Binding ViewReplayCommand}"
                            Style="{StaticResource AntButtonStyle}"
                            Padding="15,8"
                            Background="#1890FF"
                            Foreground="White"
                            BorderThickness="0"
                            IsEnabled="{Binding SelectedLogItem, Converter={StaticResource NullToBoolConverter}}" />
                        <Button
                            Margin="10,0,0,0"
                            Content="â„¹ï¸ Details"
                            Command="{Binding ViewDetailsCommand}"
                            Style="{StaticResource AntButtonStyle}"
                            Padding="15,8"
                            IsEnabled="{Binding SelectedLogItem, Converter={StaticResource NullToBoolConverter}}" />
                    </StackPanel>

                    <!-- Export Buttons -->
                    <Button
                        Grid.Column="1"
                        Margin="10,0,0,0"
                        Content="ðŸ’¾ Export Selected"
                        Command="{Binding ExportSelectedCommand}"
                        Style="{StaticResource AntButtonStyle}"
                        Padding="15,8"
                        Background="#52C41A"
                        Foreground="White"
                        BorderThickness="0"
                        IsEnabled="{Binding SelectedLogItem, Converter={StaticResource NullToBoolConverter}}" />

                    <Button
                        Grid.Column="3"
                        Content="ðŸ“¦ Export All"
                        Command="{Binding ExportAllCommand}"
                        Style="{StaticResource AntButtonStyle}"
                        Padding="15,8"
                        Background="#52C41A"
                        Foreground="White"
                        BorderThickness="0" />

                    <!-- Delete Buttons -->
                    <Button
                        Grid.Column="5"
                        Content="ðŸ—‘ï¸ Delete Selected"
                        Command="{Binding DeleteSelectedCommand}"
                        Style="{StaticResource AntButtonStyle}"
                        Padding="15,8"
                        Background="#FF4D4F"
                        Foreground="White"
                        BorderThickness="0"
                        IsEnabled="{Binding SelectedLogItem, Converter={StaticResource NullToBoolConverter}}" />

                    <!-- Close Button -->
                    <Button
                        Grid.Column="7"
                        Content="Close"
                        Command="{Binding CloseCommand}"
                        Style="{StaticResource AntButtonStyle}"
                        Padding="20,8" />
                </Grid>
            </Border>
        </Grid>
    </Border>
</Window>
